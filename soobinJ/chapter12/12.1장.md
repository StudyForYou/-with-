# 12장 타입스크립트 프로젝트 관리

## 12.1 앰비언트 타입 활용하기

### 1. 앰비언트 타입 선언

- 타입스크립트의 타입 선언은 .ts 또는 .tsx 확장자를 가진 파일에서 할 수 있지만 .d.ts 확장자를 가진 파일에서도 선언할 수 있음
- 앰비언트 타입 선언
  - .d.ts 확장자를 가진 파일에서는 타입 선언만 할 수 있으며 값을 표현할 수는 없음
  - 값을 포함하는 일반적인 선언과 구별하기 위해 .d.ts 확장자를 가진 파일에서 하는 타입 선언을 앰비언트 타입 선언이라고 부름
  - 앰비언트 타입 선언으로 값을 정의할 수 없지만 declare라는 키워드를 사용하여 어딘가에 자바스크립트 값이 존재한다는 사실을 선언할 수 있음
  - declare: 타입스크립트 컴파일러에 어떤 것의 존재 여부를 명시해주는 역할을 함, 단순히 존재 여부를 알려주기 때문에 컴파일 대상이 아님
- 대표적인 앰비언트 타입 선언 활용 사례
  - _.js, _.ts 형식이 아닌 파일을 임포트할 때 종종 에러가 발생함
  - 이미지 파일을 모듈로 임포트할 때 에러가 발생함
  - 타입스크립트는 기본적으로 .ts, .js 파일만 이해하며 그 외에 다른 파일 형식은 인식하지 못함
  - declare 키워드를 사용하여 특정 형식 모듈로 선언하면 타입스크립트 컴파일러에 미리 정보를 제공함으로써 에러를 수정할 수 있음
  ```ts
  declare module "*.png" {
      const src: string;
      export defualt src;
  }
  ```
- 자바스크립트로 작성된 라이브러리
  - 자바스크립트로 작성된 npm 라이브러리는 타입 선언이 존재하지 않음
  - 타입스크립트에서 위 라이브러리를 사용할 수는 있지만 타입 선언이 없으므로 임포트한 모듈은 모두 any로 추론됨
  - 만약 tsconfig.json 파일에서 any를 사용하지 못하게 설정했다면 프로젝트가 빌드되지 않음
  - 자바스크립트 라이브러리 내부 함수와 변수의 타입을 앰비언트 타입으로 선언하면 타입스크립트는 자동으로 .d.ts 확장자를 가진 파일을 검색하여 타입 검사를 진행함
- 타입스크립트로 작성된 라이브러리
  - 타입스크립트로 작성된 라이브러리일지라도 자바스크립트 파일과 .d.ts 파일로 배포되는 것이 일반적
  - 타입스크립트 파일을 직접 배포하여 라이브러리 사용자가 타입스크립트를 컴파일할 때 라이브러리 코드도 함께 컴파일하게 할 수 있음 -> 컴파일 시간 증가
  - .d.ts 파일이 있기 때문에 사용자는 .d.ts 파일에 정의된 타입 정보를 활용하여 라이브러리를 사용할 수 있음
  - tsconfig.json 파일의 `declaration: true`로 설정하면 타입스크립트 컴파일러는 자동으로 .d.ts 파일을 생성함
- 자바스크립트 어딘가에 전역 변수가 정의되어 있음을 타입스크립트에 알릴 때
  - 타입스크립트로 직접 구현하지 않았지만 실제 자바스크립트 어딘가에 전역 변수가 정의되어 있는 상황을 타입스크립트에 알릴 때 앰비언트 타입 선언을 사용함
  - 예시
    - 웹뷰를 개발할 때 네이티브 앱과의 통신을 위한 인터페이스를 네이티브 앱이 Window 객체에 추가하는 경우 많음
    - 전역 객체인 Window에 변수나 함수를 추가하면 타입스크립트에서 직접 구현하지 않더라도 실제 런타임 환경에서 해당 변수를 사용할 수 있음

### 2. 앰비언트 타입 선언 시 주의점

- 타입스크립트로 만드는 라이브러리에는 불필요
  - `declaration: true`로 설정하면 타입스크립트 컴파일러가 .d.ts 파일을 자동으로 생성해주기 때문에 수동으로 작성할 필요가 없음
  - 타입스크립트로 라이브러리를 개발할 때는 앰비언트 타입 선언을 사용할 필요가 없음
- 전역으로 타입을 정의하여 사용할 때 주의해야 할 점
  - 서로 다른 라이브러리에서 동일한 이름의 앰비언트 타입 선언을 한다면 충돌이 발생하여 어떤 타입 선인이 적용될지 알기 어려움, 의도한 대로 동작하지 않을 수 있음
  - 앰비언트 타입 선언은 명시적인 임포트나 익스포트가 없기 때문에 코드의 의존성 관계가 명확하지 않아 나중에 변경할 때 어려움을 겪을 수 있음

### 3. 앰비언트 타입 선언을 잘못 사용했을 때의 문제점

- .ts 파일 내의 앰비언트 변수 선언은 개발자에게 혼란을 야기할 수 있음
- .ts 파일 내부에 앰비언트 변수를 선언할 때 앰비언트 타입의 의존성 관계가 보이지 않기 때문에 변경에 의한 영향 범위를 파악하기 어려움 -> 명시적 import, export가 없이 전역적으로 사용할 수 있기 때문
- declare 키워드를 사용한 앰비언트 타입 선언은 .d.ts 파일이 아닌 .ts, .tsx 파일 내에서도 할 수 있음
- 앰비언트 변수 선언은 어느 곳에나 영향을 줄 수 있기 때문에 일반 타입 선언과 섞이게 되면 파악하기 어려움
- .d.ts 확장자 파일 내에서 앰비언트 타입 선언을 하는 것은 일종의 개발자 간의 약속

### 4. 앰비언트 타입 활용하기

- 타입을 정의하여 임포트 없이 전역으로 공유

  - .d.ts 파일에서의 앰비언트 타입 선언은 전역 변수와 같은 역할을 함
  - 앰비언트 타입을 선언하면 모든 코드 내에서 임포트 없이 사용 가능
  - 유용한 유틸리티 타입을 작성한 경우 모든 코드 내에서 임포트 없이 내장 타입 유틸리티 함수를 사용하는 것처럼 사용 가능

  ```ts
  // src/index.d.ts
  type Optional<T extends object, K extends keyof T = keyof T> = Omit<T, K> &
    Partial<Pick<T, K>>;

  // src/components.ts
  type OptionalProps = Optional<Props>;
  ```

- declare type 활용하기

  - 많이 사용하는 커스텀 유틸리티 타입을 declare type으로 선언하여 전역에서 사용할 수 있음

  ```ts
  declare type Nullalbe<T> = T | null;

  const name: Nullable<string> = "woowa";
  ```

- declare module 활용하기

- declare namespace 활용하기
  - Node.js 환경에서 .env 파일을 사용할 때, declare namespace를 활용하여 process.env로 설정값을 손쉽게 불러오고 환경변수의 자동 완성 기능을 쓸 수 있음
  ```ts
  declare namespace NodeJS {
    interface ProcessEnv {
      readonly API_URL: string;
      readonly API_INTERNAL_URL: string;
    }
  }
  ```
  - prcess.env를 통해 접근하는 변수 또한 타입을 지정할 수 있기 때문에 as 단언을 사용하지 않아도 됨
- declare global 활용하기
  - 전역 변수를 선언할 때 사용함
  ```ts
  declare global {
    interface Window {
      newProperty: string;
    }
  }
  ```
  - 전역 변수인 Window 객체의 스코프에서 사용되는 모듈이나 변수를 추가할 수 있음

### 5. declare와 번들러의 시너지

- declare global로 전역 변수를 선언하는 과정과 번들러를 통해 데이터를 주입하는 절차를 함께 활용하며 시너지를 낼 수 있음
